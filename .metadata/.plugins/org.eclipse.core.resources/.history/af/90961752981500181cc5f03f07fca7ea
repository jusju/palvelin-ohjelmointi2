package com.gallery.gallery.web;
import java.nio.file.Path;
import java.security.Principal;
import java.util.List;
import java.util.stream.Collectors;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.servlet.mvc.method.annotation.MvcUriComponentsBuilder;

import com.gallery.gallery.domain.PictureRepository;

@Controller 
public class PictureContoller {
	
	private PictureRepository prepository;
	
	public PictureContoller(PictureRepository prepository) {
		
		this.prepository = prepository;
}
	@GetMapping("/")
	public String listUploadedFiles(Model model, Principal principal) throws Exception {

		if (principal == null) {
			return "redirect:/find";
		}
		
		Picture pic = prepository.findByName(principal.getName()).orElseThrow(() -> new Exception());

		List<String> stringss = img.getImageList().stream()
				.map(image -> this.rootLocation.resolve(image.getName()))
				.map(path -> MvcUriComponentsBuilder
						.fromMethodName(ImageController.class, "serveFile", path.getFileName().toString()).build()
						.toString())				
				.collect(Collectors.toList());


		model.addAttribute("files", stringss);
		
		return "index";
}
	@GetMapping("/find")
	public String findPhotos(Model model) {
		return "findphoto";
	}
	
	
}